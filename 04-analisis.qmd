---
author: "Equipo EDUMER"
bibliography: "input/bib/merit-edjust.bib"
csl: "input/bib/apa6.csl"
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| message: false
#| warning: false

library(knitr)
knitr::opts_chunk$set(echo = TRUE, include = TRUE, warning = FALSE, message = FALSE)

table_format <- if(is_html_output()) {
  "html"
} else if(is_latex_output()) {
  "latex"
}
table_format2 <- if(is_html_output()) {
  T
} else if(is_latex_output()) {
  F
}

options(kableExtra.html.bsTable = T)
options(knitr.kable.NA = "")
```

```{r}
#| label: packages
#| echo: false
#| include: false


if (! require("pacman")) install.packages("pacman")

pacman::p_load(tidyverse, 
               sjmisc, 
               sjPlot, 
               lme4, 
               here, 
               performance,
               influence.ME, 
               marginaleffects,
               MLMusingR,
               texreg, 
               ggdist,
               misty,
               kableExtra,
               ggalluvial, 
               shadowtext,
               MetBrewer,
               patchwork,
               sjlabelled,
               summarytools,
               interactions)


options(scipen=999)
rm(list = ls())
```

```{r}
#| label: data
#| echo: false
#| include: false 

load(file = here("input/data/proc/df_study1_long_t7.RData"))

# Generate analytical sample

df_study1 <- df_study1_long_t7 %>%
  select(idencuesta,
         ola,
         ponderador_long_total,
         segmento,
         estrato,
         just_health,
         just_pension,
         just_educ,
         mjp, 
         perc_inequality, 
         merit_effort, 
         merit_talent, 
         educ,
         quintil1,
         sex,
         age,
         ess, 
         ideo) %>% 
  na.omit() %>% 
  mutate(ola = case_when(ola == 1 ~ 1,
                         ola == 2 ~ 2, 
                         ola == 3 ~ 3,
                         ola == 4 ~ 4,
                         ola == 6 ~ 5,
                         ola == 7 ~ 6)) %>% 
  mutate(ola = as.factor(ola),
         ola_num = as.numeric(ola),
         ola_2=as.numeric(ola)^2)

df_study1 <- df_study1 %>%
  group_by(idencuesta) %>%             # Agrupar por el identificador del participante
  mutate(n_participaciones = n()) %>%  # Contar el número de filas (participaciones) por participante
  ungroup()

df_study1 <- df_study1 %>% filter(n_participaciones>1)

# Corregir etiquetas

df_study1$just_health <- sjlabelled::set_label(df_study1$just_health, 
                        label = "Health distributive justice")

df_study1$just_pension <- sjlabelled::set_label(df_study1$just_pension, 
                        label = "Pension distributive justice")

df_study1$just_educ <- sjlabelled::set_label(df_study1$just_educ, 
                        label = "Education distributive justice")

df_study1$merit_effort <- sjlabelled::set_label(df_study1$merit_effort, 
                        label = "People are rewarded for their efforts")

df_study1$merit_talent <- sjlabelled::set_label(df_study1$merit_talent, 
                        label = "People are rewarded for their intelligence")

```
# Results

## Descriptive 


@fig-alluvial shows the annual frequencies of market justice preferences for healthcare, pensions, and education from 2016 to 2023. Each year presents stacked percentage frequencies, and the flows between them reflect opinion changes among the same individuals from one year to the next, given that we are using panel data. For instance, of the 40.8% who strongly disagreed with justifying inequality in healthcare in 2019, around 24.3% maintained that position in 2022, while the remaining 16.5% shifted toward other response categories—primarily moving into disagreement rather than strong disagreement. Overall, more than half of the respondents exhibit a high level of disagreement (disagree + strongly disagree) with inequality in these three social service areas over time. Despite this general pattern, recent waves show a slight decrease in disagreement and a corresponding rise in support for market-justice inequality. Specifically, in healthcare and education, although disagreement remains substantial, agreement (agree + strongly agree) increased from 7.4% and 7.2% in 2019 to 13.1% and 14.2% in 2023, respectively. This shift is most evident in pensions, where the combined agree/strongly agree category grew by about 10 percentage points, from 16.9% in 2016 to 28% in 2023.

```{r}
#| label: fig-alluvial
#| out-width: '100%'
#| fig-asp: 1.2
#| fig-cap: "Change in the justification of inequality in healthcare, pensions and education over time (2016-2023)"
#| fig-cap-location: top
#| echo: false
#| results: asis


datos.health <- df_study1 %>% 
  mutate(just_health = factor(just_health, 
                              levels = c("Strongly agree",
                                         "Agree",
                                         "Neither agree nor desagree",
                                         "Desagree",
                                         "Strongly desagree"),
                              ordered = T)) %>% 
  group_by(idencuesta, ola) %>% 
  count(just_health) %>% 
  group_by(ola) %>% 
  mutate(porcentaje=n/sum(n)) %>% 
  ungroup() %>% 
  na.omit() %>% 
  mutate(wave = case_when(ola == 1 ~ "2016",
                          ola == 2 ~ "2017",
                          ola == 3 ~ "2018",
                          ola == 4 ~ "2019",
                          ola == 5 ~ "2022",
                          ola == 6 ~ "2023"),
         wave = factor(wave, levels = c("2016",
                                      "2017",
                                      "2018",
                                      "2019",
                                      "2022",
                                      "2023")))



etiquetas.health <- df_study1 %>%
  mutate(just_health = factor(just_health, 
                              levels = c("Strongly agree",
                                         "Agree",
                                         "Neither agree nor desagree",
                                         "Desagree",
                                         "Strongly desagree"),
                              ordered = T)) %>% 
  group_by(ola, just_health) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(ola) %>%
  mutate(porcentaje = count / sum(count)) %>% 
  na.omit() %>% 
  mutate(idencuesta = 1,
         wave = case_when(ola == 1 ~ "2016",
                          ola == 2 ~ "2017",
                          ola == 3 ~ "2018",
                          ola == 4 ~ "2019",
                          ola == 5 ~ "2022",
                          ola == 6 ~ "2023"),
         wave = factor(wave, levels = c("2016",
                                        "2017",
                                        "2018",
                                        "2019",
                                        "2022",
                                        "2023")))




p1 <- datos.health %>% 
  ggplot(aes(x = wave, fill = just_health, stratum = just_health,
             alluvium = idencuesta, y = porcentaje)) +
  ggalluvial::geom_flow(alpha = .4) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) + 
  scale_fill_manual(values =  c("#0571B0","#92C5DE","#b3b3b3ff","#F4A582","#CA0020")) +
  geom_shadowtext(data = etiquetas.health,
                  aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
                  position = position_stack(vjust = .5),
                  show.legend = FALSE,
                  size = 3,
                  color = rep('white'),
                  bg.colour='grey30')+
  labs(y = "%",
       x = NULL,
       fill = NULL,
       title = "a. Healthcare") +
  theme_ggdist() +
  theme(legend.position = "none") 
  


datos.pension <- df_study1 %>% 
   mutate(just_pension = factor(just_pension, 
                              levels = c("Strongly agree",
                                         "Agree",
                                         "Neither agree nor desagree",
                                         "Desagree",
                                         "Strongly desagree"),
                              ordered = T)) %>% 
  group_by(idencuesta, ola) %>% 
  count(just_pension) %>% 
  group_by(ola) %>% 
  mutate(porcentaje=n/sum(n)) %>% 
  ungroup() %>% 
  na.omit() %>% 
  mutate(wave = case_when(ola == 1 ~ "2016",
                          ola == 2 ~ "2017",
                          ola == 3 ~ "2018",
                          ola == 4 ~ "2019",
                          ola == 5 ~ "2022",
                          ola == 6 ~ "2023"),
         wave = factor(wave, levels = c("2016",
                                        "2017",
                                        "2018",
                                        "2019",
                                        "2022",
                                        "2023")))



etiquetas.pension <- df_study1 %>%
  mutate(just_pension = factor(just_pension, 
                              levels = c("Strongly agree",
                                         "Agree",
                                         "Neither agree nor desagree",
                                         "Desagree",
                                         "Strongly desagree"),
                              ordered = T)) %>% 
  group_by(ola, just_pension) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(ola) %>%
  mutate(porcentaje = count / sum(count)) %>% 
  na.omit() %>% 
  mutate(idencuesta = 1,
         wave = case_when(ola == 1 ~ "2016",
                          ola == 2 ~ "2017",
                          ola == 3 ~ "2018",
                          ola == 4 ~ "2019",
                          ola == 5 ~ "2022",
                          ola == 6 ~ "2023"),
         wave = factor(wave, levels = c("2016",
                                        "2017",
                                        "2018",
                                        "2019",
                                        "2022",
                                        "2023")))

p2 <- datos.pension %>% 
  ggplot(aes(x = wave, fill = just_pension, stratum = just_pension,
             alluvium = idencuesta, y = porcentaje)) +
  ggalluvial::geom_flow(alpha = .4) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) + 
  scale_fill_manual(values =  c("#0571B0","#92C5DE","#b3b3b3ff","#F4A582","#CA0020")) +
  geom_shadowtext(data = etiquetas.pension,
                  aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
                  position = position_stack(vjust = .5),
                  show.legend = FALSE,
                  size = 3,
                  color = rep('white'),
                  bg.colour='grey30')+
  labs(y = "%",
       x = NULL,
       fill = NULL,
       title = "b. Pensions") +
  theme_ggdist() +
  theme(legend.position = "none") 


datos.educ <- df_study1 %>% 
  mutate(just_educ = factor(just_educ, 
                            levels = c("Strongly agree",
                                         "Agree",
                                         "Neither agree nor desagree",
                                         "Desagree",
                                         "Strongly desagree"),
                              ordered = T)) %>%
  group_by(idencuesta, ola) %>% 
  count(just_educ) %>% 
  group_by(ola) %>% 
  mutate(porcentaje=n/sum(n)) %>% 
  ungroup() %>% 
  na.omit() %>% 
  mutate(wave = case_when(ola == 1 ~ "2016",
                          ola == 2 ~ "2017",
                          ola == 3 ~ "2018",
                          ola == 4 ~ "2019",
                          ola == 5 ~ "2022",
                          ola == 6 ~ "2023"),
         wave = factor(wave, levels = c("2016",
                                        "2017",
                                        "2018",
                                        "2019",
                                        "2022",
                                        "2023")))



etiquetas.educ <- df_study1 %>%
    mutate(just_educ = factor(just_educ, 
                              levels = c("Strongly agree",
                                         "Agree",
                                         "Neither agree nor desagree",
                                         "Desagree",
                                         "Strongly desagree"),
                              ordered = T)) %>%
  group_by(ola, just_educ) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(ola) %>%
  mutate(porcentaje = count / sum(count)) %>% 
  na.omit() %>% 
  mutate(idencuesta = 1,
         wave = case_when(ola == 1 ~ "2016",
                          ola == 2 ~ "2017",
                          ola == 3 ~ "2018",
                          ola == 4 ~ "2019",
                          ola == 5 ~ "2022",
                          ola == 6 ~ "2023"),
         wave = factor(wave, levels = c("2016",
                                        "2017",
                                        "2018",
                                        "2019",
                                        "2022",
                                        "2023")))

p3 <- datos.educ %>% 
  ggplot(aes(x = wave, fill = just_educ, stratum = just_educ,
             alluvium = idencuesta, y = porcentaje)) +
  ggalluvial::geom_flow(alpha = .4) + 
  ggalluvial::geom_stratum(linetype = 0) +
  scale_y_continuous(labels = scales::percent) + 
  scale_fill_manual(values =  c("#0571B0","#92C5DE","#b3b3b3ff","#F4A582","#CA0020")) +
  geom_shadowtext(data = etiquetas.educ,
                  aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
                  position = position_stack(vjust = .5),
                  show.legend = FALSE,
                  size = 3,
                  color = rep('white'),
                  bg.colour='grey30')+
  labs(y = "%",
       x = "Wave",
       fill = NULL,
       title = "c. Education",
       caption = "Source: own elaboration with pooled data from ELSOC 2016-2023 (n = 8460)") +
  theme_ggdist() +
  theme(legend.position = "bottom") 

(p1 / p2 / p3) 

```


Regarding the main dependent and independent variables of this study, @fig-meanchange depicts their average changes over the years. We observe an increase in the average level of market justice preferences in the most recent waves, which begins in 2019. The highest average consistently appears for perceived economic inequality, although this variable shows a downward trend of roughly one point over time. Interestingly, while perceptions of economic inequality declined in the latest measurements (2022–2023), market justice preferences increased. The meritocracy measures remain stable, though the perception that individuals are rewarded for intelligence is slightly higher than the perception that they are rewarded for their effort.

```{r}
#| label: fig-meanchange
#| out-width: '100%'
#| fig-asp: 0.8
#| fig-cap: "Change in the mean of market justice preferences, economic inequality perception, and meritocracy (2016-2023)"
#| fig-cap-location: top
#| echo: false
#| results: asis


library(srvyr)

df_pond <- df_study1 %>% 
  mutate(ola = case_when(ola == 1 ~ "2016",
                         ola == 2 ~ "2017",
                         ola == 3 ~ "2018",
                         ola == 4 ~ "2019",
                         ola == 5 ~ "2022",
                         ola == 6 ~ "2023"),
         ola = factor(ola, levels = c("2016",
                                        "2017",
                                        "2018",
                                        "2019",
                                        "2022",
                                        "2023"))) %>% 
  as_survey_design(.data = .,
                   ids = segmento, 
                   strata = estrato, 
                   weights = ponderador_long_total)

df_pond %>% 
  select(ola, mjp, perc_inequality, merit_effort, merit_talent) %>% 
  mutate_at(.vars = 2:5, .funs = ~ as.numeric(.)) %>% 
  group_by(ola) %>% 
  summarise_all(~survey_mean(., vartype = "ci")) %>% 
  pivot_longer(cols = -ola,
               names_to = "temp",
               values_to = "valor") %>%
  mutate(
    ci = case_when(
      str_ends(temp, "_low") ~ "ic_low",
      str_ends(temp, "_upp") ~ "ic_upp",
      TRUE                   ~ "mean"
    ),
    variable = str_remove(temp, "_low|_upp")
  ) %>%
  select(ola, variable, ci, valor) %>%
  pivot_wider(
    names_from  = ci,
    values_from = valor
  ) %>% 
  mutate(variable = case_when(variable == "mjp" ~ "Market justice preferences",
                              variable == "perc_inequality"  ~ "Inequality perception",
                              variable == "merit_effort"     ~ "Merit: Effort",
                              variable == "merit_talent"     ~ "Merit: Talent"),
         variable = factor(variable, levels = c("Market justice preferences",
                                      "Inequality perception",
                                      "Merit: Effort",
                                      "Merit: Talent")
                              )) %>% 
  ggplot(aes(x = ola, y = mean, group = variable)) +
  geom_point(aes(shape=variable, color=variable), size = 3.5) +
  geom_line(aes(color = variable), linewidth = 0.8) +
  geom_errorbar(aes(ymin = ic_low, ymax = ic_upp, color = variable),
                width = 0.1) +
  scale_color_manual(values = c("#023858", # azul oscuro
                                "#0571B0", # azul intermedio
                                "#F4A582", # salmón
                                "#B2182B"  # rojo profundo
                                         )) +
  scale_shape_manual(values=c(15, 16, 17, 18)) +
  labs(y = "Mean",
       x = "Wave",
       color = NULL,
       shape = NULL,
       caption = "Source: own elaboration with pooled data from ELSOC 2016-2023 (n = 8460)") +
  theme_ggdist() +
  theme(legend.position = "top",
        text = element_text(size = 12)) 
 
```

@fig-matrix presents the correlation matrix for the main variables in the latest wave (2023). Overall, the coefficients range from low to moderate. The association between market justice preferences and economic inequality perception is negative but small and statistically significant ($r$ = -0.05, $p$ < .05). By contrast, market justice preferences positively and significantly correlate with the two meritocracy variables ($r$ = 0.15, $p$ < .01; $r$ = 0.13, $p$ < .01). Perceived economic inequality has negative and nonsignificant correlations with both meritocracy perceptions ($r$ = -0.04, $p$ > .05; $r$ = -0.04, $p$ > .05). Finally, the two meritocracy variables exhibit a strong positive association with each other ($r$ = 0.69, $p$ < .01).


```{r}
#| label: fig-matrix
#| out-width: '90%'
#| fig-asp: 1
#| fig-cap: "Correlation matrix of the main variables for the last wave (2023)"
#| fig-cap-location: top
#| echo: false
#| results: asis


M <- df_study1 %>%
  filter(ola == 6) %>% 
  select(mjp, perc_inequality, merit_effort, merit_talent) %>% 
  mutate_all(.funs = ~ as.numeric(.)) %>% 
  cor(use = "pairwise.complete.obs", method = "pearson")

diag(M) <- NA

rownames(M) <- c("A. Marjet justice preferences",
                 "B. Inequality gap perception",
                 "C. People are rewarded for their efforts ",
                 "D. People are rewarded for their intelligence")

#set Column names of the matrix
colnames(M) <-c("(A)", "(B)","(C)","(D)")

#Plot the matrix using corrplot
corrplot::corrplot(M,
                   method = "color",
                   addCoef.col = "black",
                   type = "upper",
                   tl.col = "black",
                   col = colorRampPalette(c("#E16462", "white", "#0D0887"))(12),
                   bg = "white",
                   na.label = "-") 

```


## Multilevel models

@tbl-modelos presents the results of the multilevel models estimated for market justice preferences, examining both individuals (within) and group-level (between) effects. The intraclass correlation [@hoxMultilevelAnalysisTechniques2017a] from the empty model (see Supplementary Material), which decomposes the variance of market justice preferences, is 0.23, indicating that approximately 23% of the variation is attributable to differences between individuals. Complementary, 77% of the variation corresponds to within-individual differences over time.


```{r, echo=FALSE, include=FALSE}

df_study1$merit_effort <- as_numeric(df_study1$merit_effort)
df_study1$merit_talent <- as_numeric(df_study1$merit_talent)

df_study1 <- df_study1 %>% 
  mutate(ola = case_when(ola == 1 ~ "2016",
                         ola == 2 ~ "2017",
                         ola == 3 ~ "2018",
                         ola == 4 ~ "2019",
                         ola == 5 ~ "2022",
                         ola == 6 ~ "2023"),
         ola = factor(ola, levels = c("2016",
                                        "2017",
                                        "2018",
                                        "2019",
                                        "2022",
                                        "2023")))


df_study1 <- df_study1 %>% 
  group_by(idencuesta) %>% 
  mutate(perc_inequality_mean = mean(perc_inequality, na.rm = T),
         perc_inequality_cwc = perc_inequality - perc_inequality_mean,
         merit_effort_mean = mean(merit_effort, na.rm = T),
         merit_effort_cwc = merit_effort - merit_effort_mean,
         merit_talent_mean = mean(merit_talent, na.rm = T),
         merit_talent_cwc = merit_talent - merit_talent_mean,
         ) %>% 
  ungroup()
```



```{r}
#| echo: false
#| include: false 

m0 <- lmer(mjp ~ 1 + (1 | idencuesta), 
                data = df_study1)

performance::icc(m0, by_group = T)

df_study1 <- df_study1 %>%
  mutate(
    perc_inequality_cwc_dic = ifelse(perc_inequality_cwc > mean(perc_inequality_cwc, na.rm = TRUE), "mayor", "menor"),
    merit_effort_cwc_dic = ifelse(merit_effort_cwc > mean(merit_effort_cwc, na.rm = TRUE), "mayor", "menor"),
    merit_talent_cwc_dic = ifelse(merit_talent_cwc > mean(merit_talent_cwc, na.rm = TRUE), "mayor", "menor"),
    perc_inequality_mean_dic = ifelse(perc_inequality_mean > mean(perc_inequality_mean, na.rm = TRUE), "mayor", "menor"),
    merit_effort_mean_dic = ifelse(merit_effort_mean > mean(merit_effort_mean, na.rm = TRUE), "mayor", "menor"),
    merit_talent_mean_dic = ifelse(merit_talent_mean > mean(merit_talent_mean, na.rm = TRUE), "mayor", "menor")
  ) %>%
  mutate(across(ends_with("_dic"), factor, levels = c("menor", "mayor")))

## WE and BE

m1 <- lmer(mjp ~ 1 + ola + (1 | idencuesta),
                data = df_study1)

m1.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + (1 | idencuesta),
                data = df_study1)

m2 <- lmer(mjp ~ 1 + ola_num + ola_2 + (1 + ola_num | idencuesta),
                data = df_study1)

anova(m1.1, m2)

m3 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + (1 + ola_num | idencuesta), 
           data = df_study1)

m4 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + (1 + ola_num | idencuesta),
                data = df_study1)

m5 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean +  (1 + ola_num | idencuesta),
                data = df_study1)

m6 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean +  merit_effort_mean + merit_talent_mean + (1 + ola_num | idencuesta),
                data = df_study1)

m7 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + (1 + ola_num | idencuesta),
                data = df_study1)


# interactions 
m8 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_effort_cwc_dic*perc_inequality_cwc_dic + merit_talent_cwc*perc_inequality_cwc +
              (1 + merit_effort_cwc + merit_talent_cwc + perc_inequality_cwc | idencuesta),
                data = df_study1)

m8.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_effort_cwc*perc_inequality_cwc +
              (1 + merit_effort_cwc + perc_inequality_cwc | idencuesta),
                data = df_study1)

m8.2 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_talent_cwc*perc_inequality_cwc +
              (1 + merit_talent_cwc + perc_inequality_cwc | idencuesta),
                data = df_study1)

m9 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_effort_mean*perc_inequality_mean + merit_talent_mean*perc_inequality_mean +
              (1 | idencuesta),
                data = df_study1)

m9.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_effort_mean*perc_inequality_mean +
              (1 | idencuesta),
                data = df_study1)

m9.2 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_talent_mean*perc_inequality_mean +
              (1 | idencuesta),
                data = df_study1)

# growth curves

m10 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality*ola_num + merit_effort + merit_talent + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + (1 + perc_inequality + ola_num| idencuesta),
                data = df_study1)

m10.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc*ola_num + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + (1 + perc_inequality_cwc + ola_num| idencuesta),
                data = df_study1)

m10.2 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean*ola_num + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + (1 + perc_inequality_mean + ola_num| idencuesta),
                data = df_study1)


m11 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality + merit_effort*ola_num  + merit_talent + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + (1 + merit_effort + ola_num| idencuesta),
                data = df_study1)

m11.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc*ola_num  + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + (1 + merit_effort_cwc + ola_num| idencuesta),
                data = df_study1) 

m11.2 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc + merit_effort_cwc  + merit_talent_cwc + perc_inequality_mean + merit_effort_mean*ola_num + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + (1 + merit_effort_mean + ola_num| idencuesta),
                data = df_study1) 

m12 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort + merit_talent*ola_num + perc_inequality_mean +  merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
              (1 + merit_talent + ola_num| idencuesta),
                data = df_study1)

m12.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort_cwc + merit_talent_cwc*ola_num + perc_inequality_mean +  merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
              (1 + merit_talent_cwc + ola_num| idencuesta),
                data = df_study1) 

m12.2 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort_cwc + merit_talent_cwc + perc_inequality_mean +  merit_effort_mean + merit_talent_mean*ola_num + educ + quintil1 + ess + ideo + sex + age + 
              (1 + merit_talent_mean + ola_num| idencuesta),
                data = df_study1) 

m13 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality  + merit_effort + merit_talent + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_effort*perc_inequality*ola_num +
              (1 + perc_inequality + merit_effort  + ola_num| idencuesta),
                data = df_study1)

m13.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc  + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             merit_effort_cwc*perc_inequality_cwc*ola_num +
              (1 + perc_inequality_cwc + merit_effort_cwc + ola_num| idencuesta),
                data = df_study1)

m13.2 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc  + merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
             ola_num*merit_effort_mean*perc_inequality_mean +
              (1 + perc_inequality_mean + merit_effort_mean  + ola_num| idencuesta),
                data = df_study1)

m14 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality +  merit_effort + merit_talent + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
              merit_talent*perc_inequality*ola_num +
              (1 + perc_inequality + merit_talent + ola_num| idencuesta),
                data = df_study1) 

m14.1 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
              merit_talent_cwc*perc_inequality_cwc*ola_num +
              (1 + perc_inequality_cwc + merit_talent_cwc + ola_num| idencuesta),
                data = df_study1) 

m14.2 <- lmer(mjp ~ 1 + ola_num + ola_2 + perc_inequality_cwc +  merit_effort_cwc + merit_talent_cwc + perc_inequality_mean + merit_effort_mean + merit_talent_mean + educ + quintil1 + ess + ideo + sex + age + 
              merit_talent_mean*perc_inequality_mean*ola_num +
              (1 + perc_inequality_mean + merit_talent_mean + ola_num| idencuesta),
                data = df_study1) 



#knitreg(list(m13.1, m13.2,m14.1, m14.2))
```

```{r, include=FALSE, eval=FALSE}
interactions::interact_plot(m13.2, pred = "merit_effort_mean", modx="perc_inequality_mean", mod2="ola_num")
```


```{r echo=FALSE, results='asis'}
#| label: tbl-modelos
#| tbl-cap: "Longitudinal multilevel models for market justice preferences"
#| tbl-cap-location: top

omit <- "(educ)|(quintil1)|(ess)|(ideo)|(sex)|(age)"

ccoef <- list(
  "(Intercept)" = "Intercept",
  "ola2017" = "Wave 2017",
  "ola2018" = "Wave 2018",
  "ola2019" = "Wave 2019",
  "ola2022" = "Wave 2022",
  "ola2023" = "Wave 2023",
  ola_num = "Wave",
  ola_2 = "Wave^2",
  perc_inequality_cwc = "Perception inequality (WE)",
  merit_effort_cwc = "Merit: Effort (WE)",
  merit_talent_cwc = "Merit: Talent (WE)",
  perc_inequality_mean = "Perception inequality (BE)",
  merit_effort_mean = "Merit: Effort (BE)",
  merit_talent_mean = "Merit: Talent (BE)"
  )

texreg::knitreg(list(m1, m2, m3, m4, m5, m6, m7),
               custom.model.names = c(paste0("Model ", seq(1:7))),
               caption = NULL,
               stars = c(0.05, 0.01, 0.001),
               omit.coef = omit,
               custom.coef.map = ccoef,
               digits = 3,
               groups = list("Wave (Ref.= 2016)" = 2:6),
               custom.note = "Note: Cells contain regression coefficients with standard errors in parentheses. %stars.",
               leading.zero = T,
               use.packages = F,
               booktabs = F,
               scalebox = 0.79,
               include.loglik = FALSE,
               include.aic = FALSE,
               center = T,
               custom.gof.names = c("BIC", "Numb. obs.", "Num. groups: individuals", "Var: individuals (Intercept)", "Var: Residual", "Var: individuals, wave", "Cov: individuals (Intercept), wave"),
               custom.gof.rows = list("Controls"=c(rep("No",6), "Yes")))
               

```

According to Model 1, which includes the survey waves to capture intertemporal variations in the dependent variable, there is a decrease in 2017 ($\beta$ = -0.167, $p$ < .001) relative to 2016, and similarly in 2018 ($\beta$ = -0.025, $p$ > .05) and 2019 ($\beta$ = -0.046, $p$ > .05), although the latter effects are not statistically significant. In contrast, in the more recent waves of 2022 and 2023, there is a statistically significant increase in market justice preferences ($\beta$ = 0.285, $p$ < .001; $\beta$ = 0.284, $p$ < .001), suggesting a non-linear effect. To model this trajectory over time, Model 2 incorporates time (survey waves) as a continuous variable, along with its quadratic term, representing the non-linear association initially observed in Model 1. While the linear term (survey wave) shows a negative association, reflecting an overall decline in market preferences over time, the positive quadratic term indicates a reversal of this pattern in the final measurement points.

Models 3 and 4 incorporate the within-group effects (WE) of the primary independent variables, capturing how individual changes in these variables over time shape the dependent variable. The results in Model 3 suggest that the within effect of perceived economic inequality is negative and statistically significant ($p$ < .001). Specifically, each one-point increase in an individual’s perception of economic inequality between waves is associated with a 0.034 point decrease in market justice preferences. Model 4 shows that meritocratic beliefs operate in the opposite direction. An upward shift in the perception that effort is rewarded exerts a positive within effect ($\beta$ = 0.071, $p$ < .001), and a parallel increase in the perception that intelligence and ability are rewarded is likewise associated with higher market-justice preferences ($\beta$ = 0.028, $p$ < .05). Taken together, these results suggest that individuals who increasingly perceive meritocracy—whether through effort or talent—tend to hold stronger market justice preferences.

When examining the between-group effects (BE) in Model 5 and 6, which capture differences between individuals in the average of the main variables, a similar pattern emerges. Individuals who perceive higher levels of economic inequality tend to prefer less market justice ($\beta$ = -0.042, $p$ < .05). In Model 6, the meritocratic perception that effort is rewarded is positively associated with market justice preferences ($\beta$ = 0.186, $p$ < .001), whereas the perception that talent is rewarded shows a positive but non-significant coefficient ($\beta$ = 0.040). Notably, once the meritocratic variables are included, the negative coefficient for perceived economic inequality remains but is no longer statistically significant.

Model 7 adds the control variables. With the exception of the between-effect for perceived economic inequality—which becomes nonsignificant—the within- and between-effects of the principal predictors retain both their direction and statistical significance, confirming the robustness of the associations (see Supplementary Material for effects of control variables).


```{r echo=FALSE, results='asis'}
#| label: tbl-interactions1
#| tbl-cap: "Interactions for meritocracy, perceived economic inequality and market justice preferences"
#| tbl-cap-location: top

ccoef <- list(
  "(Intercept)" = "Intercept",
  "perc_inequality_cwc:merit_effort_cwc" = "Merit: Effort (WE) x Perception inequality (WE)",
  "perc_inequality_cwc:merit_talent_cwc" = "Merit: Talent (WE) x Perception inequality (WE)",
  "perc_inequality_mean:merit_effort_mean" = "Merit: Effort (BE) x Perception inequality (BE)",
  "perc_inequality_mean:merit_talent_mean" = "Merit: Talent (BE) x Perception inequality (BE)"
  )

texreg::knitreg(list(m8.1,m8.2,m9.1,m9.2),
               custom.model.names = c("Model 8", "Model 9", "Model 10", "Model 11"),
               caption = NULL,
               stars = c(0.05, 0.01, 0.001),
               custom.coef.map = ccoef,
               digits = 3,
               custom.note = "Note: Cells contain regression coefficients with standard errors in parentheses. %stars. CWC = centered within group.",
               leading.zero = T,
               use.packages = F,
               booktabs = F,
               scalebox = 0.8,
               include.loglik = FALSE,
               include.aic = FALSE,
               center = T,
               custom.gof.names = c("BIC", 
                                    "Numb. obs.", 
                                    "Num. groups: individuals", 
                                    "Var: individuals (Intercept)", 
                                    "Var: individuals, merit effort cwc", 
                                    "Var: individuals, perception inequality cwc", 
                                    "Cov: individuals (Intercept), merit effort cwc",
                                    "Cov: individuals (Intercept), perception inequality cwc",
                                    "Cov: individuals, merit effort cwc, perception inequality cwc",
                                    "Var: Residuals",
                                    "Var: individuals, merit talent cwc", 
                                    "Cov: individuals (Intercept), merit talent cwc",
                                    "Cov: individuals, merit talent cwc, perception inequality cwc"),
               custom.gof.rows = list("Controls"=c(rep("Yes",4))))




```

```{r}
#| label: fig-interact
#| out-width: '100%'
#| fig-asp: 1
#| fig-cap: "Between effects of meritocratic perceptions on market justice preferences by economic inequality perception"
#| fig-cap-location: top
#| echo: false
#| results: asis


library(ggeffects)


p6 <- marginaleffects::plot_slopes(model = m9.1,
                             variables = "merit_effort_mean",
                             condition = "perc_inequality_mean",
                             conf_level = .95) +
  geom_hline(yintercept = 0,
             color = "red",
             linetype = "dashed") +
  labs(x = "Perception inequality (BE)",
       y = "Marginal effect of Merit: Effort (BE)",
       fill = NULL,
       title = "(A) People are rewarded by their efforts") +
  theme_ggdist()


  

p7 <- marginaleffects::plot_slopes(model = m9.2,
                             variables = "merit_talent_mean",
                             condition = "perc_inequality_mean",
                             conf_level = .95) +
  geom_hline(yintercept = 0,
             color = "red",
             linetype = "dashed") +
  labs(x = "Perception inequality (BE)",
       y = "Marginal effect of Merit: Talent (BE)",
       fill = NULL,
       title = "(B) People are rewarded for their intelligence",
       caption = "Source: own elaboration with pooled data from ELSOC 2016-2023 (n = 8460)
       Confidence intervals at 95%") +
  theme_ggdist()


library(ggpubr)
ggpubr::ggarrange(p6, p7, common.legend=TRUE, ncol=1)

```

@tbl-interactions1 examines whether perceived economic inequality moderates the effect of meritocratic beliefs on market justice preferences. Contrary to our hypothesis, the interaction terms in the within-person specification (Models 8 and 9) do not reach statistical significance. However, in the between-person specification (Models 10 and 11), the interaction terms are statistically significant, suggesting that perceptions of economic inequality meaningfully alter the effect of meritocracy on support for market-based allocation of social services. These positive effects indicate that, as perceptions of inequality increase, the positive association between meritocratic perceptions and market justice preferences becomes stronger. The marginal effects of this interaction are illustrated in @fig-interact, which shows that the effect of meritocratic perceptions on market justice preferences intensifies as perceived economic inequality rises.

```{r echo=FALSE, results='asis'}
#| label: tbl-interactions2
#| tbl-cap: "Interactions for meritocracy, perceived economic inequality and market justice preferences"
#| tbl-cap-location: top

ccoef <- list(
  "(Intercept)" = "Intercept",
  "ola_num:perc_inequality_cwc" = "Wave x Perception inequality (WE)",
  "ola_num:merit_effort_cwc" = "Wave x Merit: effort (WE)",
  "ola_num:merit_talent_cwc" = "Wave x Merit: talent (WE)",
  "ola_num:perc_inequality_mean" = "Wave x Perception inequality (BE)",
  "ola_num:merit_effort_mean" = "Wave x Merit: effort (BE)",
  "ola_num:merit_talent_mean" = "Wave x Merit: talent (BE)"
    )

texreg::knitreg(list(m10.1, m11.1, m12.1, m10.2, m11.2, m12.2),
               custom.model.names = c("Model 12", "Model 13", "Model 14", "Model 15", "Model 16", "Model 17"),
               caption = NULL,
               stars = c(0.05, 0.01, 0.001),
               custom.coef.map = ccoef,
               digits = 3,
               custom.note = "Note: Cells contain regression coefficients with standard errors in parentheses. %stars. CWC = centered within group.",
               leading.zero = T,
               use.packages = F,
               booktabs = F,
               scalebox = 0.8,
               include.loglik = FALSE,
               include.aic = FALSE,
               center = T,
               custom.gof.names = c("BIC", 
                                    "Numb. obs.", 
                                    "Num. groups: individuals", 
                                    "Var: individuals (Intercept)", 
                                    
                                    "Var: individuals, perception inequality cwc",
                                    "Var: individuals, wave",
                                    "Cov: individuals (Intercept), perception inequality cwc",
                                    "Cov: individuals (Intercept), wave",
                                    "Cov: individuals, perception inequality cwc, wave",
                                    "Var: Residuals",
                                    "Var: individuals, merit effort cwc", 
                                    "Cov: individuals (Intercept), merit effort cwc",
                                    "Cov: individuals, merit effort cwc, wave",
                                    
                                    
                                    "Var: individuals, merit talent cwc", 
                                    "Cov: individuals (Intercept), merit talent cwc",
                                    "Cov: individuals, merit talent cwc, wave",
                                    
                                    "Var: individuals, perception inequality mean", 
                                    "Cov: individuals (Intercept), perception inequality mean",
                                    "Cov: individuals, perception inequality mean, wave",
                                    
                                     "Var: individuals, merit effort mean", 
                                    "Cov: individuals (Intercept), merit effort mean",
                                    "Cov: individuals, merit effort mean, wave",
                                    
                                    
                                    "Var: individuals, merit talent mean", 
                                    "Cov: individuals (Intercept), merit talent mean",
                                    "Cov: individuals, merit talent mean, wave"
                                    ),
               custom.gof.rows = list("Controls"=c(rep("Yes",6))))




```


```{r}
#| label: fig-growth
#| out-width: '100%'
#| fig-asp: 1
#| fig-cap: "Time varying within effects of meritocratic perceptions on market justice preferences"
#| fig-cap-location: top
#| echo: false
#| results: asis
#| include: false
#| eval: false


library(ggeffects)


p4 <- ggpredict(m11.2, terms = c("ola_num [all]", "merit_effort_mean")) %>% 
  plot() + 
  scale_x_continuous(n.breaks = 6) +
  scale_color_manual(
    name = "Merit:\nEffort",
    values = c("#D55E00", "#0072B2", "#009E73"),
    labels = c("-1 SD", "Mean", "+1 SD")
  ) +
  scale_fill_manual(
    name = "Merit:\nEffort",
    values = c("#D55E00", "#0072B2", "#009E73"),
    labels = c("-1 SD", "Mean", "+1 SD")) +
  labs(x = "Wave",
       title = "(A) People are rewarded for their efforts",
       color = NULL) +
  ggdist::theme_ggdist() +
  theme(legend.position = "top")
  

p5 <- ggpredict(m12.2, terms = c("ola_num [all]", "merit_talent_mean")) %>% 
  plot() +
  scale_x_continuous(n.breaks = 6) +
  scale_color_manual(
    name = "Merit:\nTalent",
    values = c("#D55E00", "#0072B2", "#009E73"),
    labels = c("-1 SD", "Mean", "+1 SD")
  ) +
  scale_fill_manual(
    name = "Merit:\nTalent",
    values = c("#D55E00", "#0072B2", "#009E73"),
    labels = c("-1 SD", "Mean", "+1 SD")
  ) +
  labs(
    x = "Wave",
    title = "(B) People are rewarded for their intelligence",
    caption = "Source: own elaboration with pooled data from ELSOC 2016-2023 (n = 8460)"
  ) +
  ggdist::theme_ggdist() +
  theme(legend.position = "top")


ggpubr::ggarrange(p4, p5, common.legend=FALSE, ncol=1)

```


With respect to the temporal dynamics of the key predictors, @tbl-interactions2 shows that time only has significant effects on the between effects of the meritocratic variables. These interaction effects are negative and mean that in the last waves, the impact of meritocratic variables on market justice preferences is attenuated. Specifically, as time advances, the positive within-person effect of perceiving that effort is rewarded (Model 16) or that intelligence is rewarded (Model 17) progressively attenuates. Put differently, the uplift in market justice preferences associated with a strong meritocratic perception becomes smaller in each successive wave.
